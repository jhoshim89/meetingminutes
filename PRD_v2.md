# Meeting Minutes v2 - Product Requirements Document

## 개요

음성 회의 녹음을 자동으로 텍스트 변환하고, 화자를 구분하며, AI로 회의록을 생성하는 개인용 시스템.

**핵심 가치**: 매번 화자를 수동으로 지정하는 번거로움 해결 → **화자 자동 매칭**

---

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                        iPhone                                │
│  ┌─────────────┐     ┌─────────────┐                        │
│  │ 기본 녹음앱  │ ──▶ │   iCloud    │                        │
│  └─────────────┘     └──────┬──────┘                        │
└────────────────────────────┼────────────────────────────────┘
                             │ 자동 동기화
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                      PC (RTX 3060 12GB)                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              PC Worker (Python)                      │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐          │   │
│  │  │ iCloud   │  │  STT     │  │ 화자구분  │          │   │
│  │  │ 모니터링  │─▶│ Whisper  │─▶│ Pyannote │          │   │
│  │  └──────────┘  └──────────┘  └────┬─────┘          │   │
│  │                                    │                │   │
│  │  ┌──────────┐  ┌──────────┐  ┌────▼─────┐          │   │
│  │  │ Word생성 │◀─│ AI요약   │◀─│ 화자매칭  │          │   │
│  │  │ (로컬저장)│  │ Ollama   │  │ (임베딩)  │          │   │
│  │  └──────────┘  └──────────┘  └──────────┘          │   │
│  └─────────────────────────────────────────────────────┘   │
│       │                                                     │
│       ▼ 오디오 원본 보관                                    │
│  ┌─────────────┐                                           │
│  │  로컬 폴더   │                                           │
│  └─────────────┘                                           │
└────────────────────────────────────────────────────────────┘
                             │
                             │ 결과만 업로드 (용량 절약)
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                     Supabase (클라우드)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  meetings   │  │ transcripts │  │  speakers   │         │
│  │  (메타정보)  │  │  (대화내용)  │  │ (임베딩저장) │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└────────────────────────────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                      PWA (웹 브라우저)                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  회의 목록   │  │ Transcript  │  │  화자 관리   │         │
│  │  + RAG검색  │  │ + 요약 보기  │  │ + 이름 수정  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

---

## 핵심 기능 요구사항

### 1. 화자 자동 매칭 (⭐ 최우선)

**목적**: 매번 화자를 수동으로 지정하는 번거로움 해결

| 항목 | 설명 |
|------|------|
| 매칭 기준 | 음성 임베딩 유사도 (코사인 유사도) |
| 임계값 | 모든 후보 제안, 사용자 최종 확인 |
| 화자 등록 | 회의 결과에서 등록 + 별도 관리 화면 |

**화자 수정 UI 요구사항**:
- "이 구간만" 수정
- "이후 구간부터" 일괄 수정
- "전체 구간" 일괄 수정

### 2. AI 자동 분류

발언 내용을 자동으로 분류:
- 논의
- 문제점
- 의견
- 결의

### 3. 회의록 Word 생성

| 항목 | 설명 |
|------|------|
| 저장 위치 | PC 로컬 폴더 |
| 템플릿 | 회사 공식 포맷 (나중에 제공) |
| 포함 항목 | 제목, 일시, 참석자, 논의/문제점/의견/결의, 액션아이템 |

### 4. 입력 방식

| 방식 | 설명 |
|------|------|
| iCloud 자동 | PC Worker가 iCloud 폴더 모니터링, 새 파일 자동 처리 |
| PWA 수동 | 웹에서 파일 선택하여 업로드 |

### 5. 출력 방식

| 출력물 | 위치 | 내용 |
|--------|------|------|
| 회의록 (Word) | PC 로컬 | 회사 템플릿 형식 |
| Transcript | PWA | 전체 대화 + 화자 표시 |
| 회의요약 | PWA | AI 요약 + 핵심포인트 + 액션아이템 |

---

## 기술 스택

| 컴포넌트 | 기술 |
|---------|------|
| STT | WhisperX (large-v2) 또는 seastar105/whisper-medium-ko-zeroth |
| 화자 구분 | Pyannote 3.0 |
| 화자 임베딩 | speechbrain/spkrec-ecapa-tdnn |
| AI 요약 | Ollama + Gemma2 7B |
| DB | Supabase (PostgreSQL + pgvector) |
| 프론트엔드 | Flutter PWA |
| 백엔드 | Python PC Worker |

---

## 설정 및 제약사항

| 항목 | 설정 |
|------|------|
| 인증 | 없음 (개인용) |
| 언어 | 한국어만 |
| 회의 길이 | 30분 ~ 1시간 |
| 처리 방식 | 한 번에 하나씩 (FIFO) |
| 실패 처리 | 자동 재시도 3회 + 알림 |
| 로깅 | 상세 로그 |
| 데이터 저장 | 결과만 Supabase, 오디오 원본은 로컬 PC |
| 비용 | 무료 (Supabase 무료 티어 + 로컬 GPU) |

---

## 구현 계획

### Phase 1: 기본 기능 (1-2일)
- [x] STT threshold 0.4 조정
- [x] 한국어 파인튜닝 모델 통합
- [ ] iCloud 폴더 모니터링
- [ ] 화자 자동매칭 (기본)
- [ ] Word 회의록 생성 (기본 템플릿)

### Phase 2: 핵심 기능 (3-5일)
- [ ] 화자 수정 UI (구간별 선택)
- [ ] AI 자동분류 (논의/문제점/의견/결의)
- [ ] 회사 Word 템플릿 적용
- [ ] 화자 관리 화면 개선

### Phase 3: 완성 (2-3일)
- [ ] E2E 테스트
- [ ] 버그 수정
- [ ] 성능 최적화

---

## 기존 구현 현황

| 기능 | 상태 | 파일 |
|------|------|------|
| STT (WhisperX) | ✅ 완료 | `whisperx_engine.py` |
| 한국어 모델 | ✅ 완료 | `whisper_korean_engine.py` |
| 화자 구분 | ✅ 완료 | `speaker_diarization.py` |
| 화자 임베딩 | ✅ 완료 | `embedding_engine.py` |
| AI 요약 | ✅ 완료 | `summarizer.py` |
| RAG 검색 | ✅ 완료 | `rag_search.py` |
| Supabase 연동 | ✅ 완료 | `supabase_client.py` |
| Flutter PWA | ✅ 완료 | `flutter_app/` |
| iCloud 모니터링 | ❌ 미구현 | - |
| 화자 자동매칭 강화 | ⚠️ 부분 | - |
| 화자 수정 UI | ❌ 미구현 | - |
| AI 자동분류 | ❌ 미구현 | - |
| Word 템플릿 | ⚠️ 기본만 | - |

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2026-01-15 | v2.0 | 아키텍처 재설계: PWA 녹음 → iCloud 연동으로 변경, 화자 자동매칭 핵심 기능으로 추가 |
